import{u as ae,r as i,j as e,H as se,d as u}from"./app-B2oWfsIg.js";import{A as te}from"./AuthenticatedLayout-DKBr3Dsa.js";import{A as ne}from"./arrow-left-CcFwPiux.js";import"./createLucideIcon-DO_NnYHa.js";import"./phone-BtrsRlbF.js";function ge({bangsaList:q,negeriList:O,bandarList:re,parlimenList:le,kadunList:ie,daerahMengundiList:oe,keahlianPartiList:A,kecenderunganPolitikList:B,lokalitiList:h,prefill:o}){const{data:s,setData:r,post:T,processing:_,errors:n}=ae({nama:o?.nama||"",no_ic:o?.no_ic||"",umur:"",no_tel:"",bangsa:o?.bangsa||"",alamat:"",poskod:"",negeri:o?.negeri||"",bandar:"",parlimen:o?.parlimen||"",kadun:o?.kadun||"",mpkk:"",daerah_mengundi:o?.daerah_mengundi||"",lokaliti:o?.lokaliti||"",keahlian_parti:"",kecenderungan_politik:""}),[U,p]=i.useState([]),[Y,P]=i.useState(!1),[F,b]=i.useState([]),[R,D]=i.useState(!1),[M,f]=i.useState([]),[H,C]=i.useState(!1),[z,j]=i.useState([]),[W,S]=i.useState(!1),[K,m]=i.useState([]),[G,x]=i.useState(!1),k=i.useRef(null),N=i.useRef(null);i.useEffect(()=>{(async()=>{if(!s.negeri){p([]);return}P(!0);try{const t=await u.get(route("api.parlimen.by-negeri"),{params:{negeri:s.negeri}});p(t.data)}catch(t){console.error("Error fetching Parlimen:",t),p([])}finally{P(!1)}})()},[s.negeri]),i.useEffect(()=>{(async()=>{if(!s.parlimen){b([]);return}D(!0);try{const t=await u.get(route("api.kadun.by-bandar"),{params:{bandar:s.parlimen}});b(t.data)}catch(t){console.error("Error fetching KADUN:",t),b([])}finally{D(!1)}})()},[s.parlimen]),i.useEffect(()=>{(async()=>{if(!s.kadun){j([]);return}S(!0);try{const t=await u.get(route("api.mpkk.by-kadun"),{params:{kadun:s.kadun}});j(t.data)}catch(t){console.error("Error fetching MPKK:",t),j([])}finally{S(!1)}})()},[s.kadun]),i.useEffect(()=>{(async()=>{if(!s.parlimen){f([]);return}C(!0);try{const t=await u.get(route("api.daerah-mengundi.by-bandar"),{params:{bandar:s.parlimen}});f(t.data)}catch(t){console.error("Error fetching Daerah Mengundi:",t),f([])}finally{C(!1)}})()},[s.parlimen]);const J=a=>{const l=a.target.value.replace(/\D/g,"");if(l.length>12)return;if(r("no_ic",l),k.current&&clearTimeout(k.current),l.length>=3?k.current=setTimeout(()=>{u.get(route("api.voter.suggest-ic"),{params:{ic:l}}).then(L=>{m(L.data||[]),x((L.data||[]).length>0)}).catch(()=>m([]))},300):(m([]),x(!1)),l.length<6){r("umur","");return}const d=l.substring(0,2),c=l.substring(2,4),$=l.substring(4,6),ee=parseInt(d)<=25?2e3+parseInt(d):1900+parseInt(d),y=new Date(ee,parseInt(c)-1,parseInt($)),w=new Date;let g=w.getFullYear()-y.getFullYear();const I=w.getMonth()-y.getMonth();(I<0||I===0&&w.getDate()<y.getDate())&&g--,g>=0&&g<=150&&r("umur",g.toString())},Q=a=>{const l=a.target.value.replace(/\D/g,"");r("no_tel",l)},E=(a,t)=>{r(a,t.toUpperCase())};i.useEffect(()=>{(async()=>{if(s.poskod.length===5)try{const t=await u.get(route("api.postcodes.search-details"),{params:{query:s.poskod}});if(t.data&&t.data.length>0){const l=t.data[0];r({...s,negeri:l.negeri_nama||"",bandar:l.city||"",parlimen:l.bandar_nama||""})}}catch(t){console.error("Error fetching postcode details:",t)}})()},[s.poskod]),i.useEffect(()=>{const a=t=>{N.current&&!N.current.contains(t.target)&&x(!1)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[]),i.useEffect(()=>{if(o?.no_ic&&o.no_ic.length===12){const a=o.no_ic,t=parseInt(a.substring(0,2))<=25?2e3+parseInt(a.substring(0,2)):1900+parseInt(a.substring(0,2)),l=new Date(t,parseInt(a.substring(2,4))-1,parseInt(a.substring(4,6))),d=new Date;let c=d.getFullYear()-l.getFullYear();(d.getMonth()<l.getMonth()||d.getMonth()===l.getMonth()&&d.getDate()<l.getDate())&&c--,c>=0&&c<=150&&r("umur",c.toString())}},[]);const v=a=>a?a.toLowerCase().replace(/\b\w/g,t=>t.toUpperCase()):"",V=a=>{r({...s,no_ic:a.no_ic,nama:a.nama||s.nama,lokaliti:a.lokaliti||s.lokaliti,daerah_mengundi:a.daerah_mengundi||s.daerah_mengundi,kadun:a.kadun?v(a.kadun):s.kadun,parlimen:a.parlimen?v(a.parlimen):s.parlimen,negeri:a.negeri?v(a.negeri):s.negeri,bangsa:a.bangsa||s.bangsa}),x(!1),m([])},X=a=>{const t=a.target.value.replace(/\D/g,"");t.length<=5&&r("poskod",t)},Z=a=>{a.preventDefault(),T(route("reports.data-pengundi.store"))};return e.jsxs(te,{children:[e.jsx(se,{title:"Borang Data Pengundi"}),e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>window.history.back(),className:"p-2 hover:bg-slate-100 rounded-lg transition-colors",children:e.jsx(ne,{className:"h-5 w-5 text-slate-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Borang Data Pengundi"}),e.jsx("p",{className:"text-sm text-slate-600 mt-1",children:"Isi semua maklumat yang diperlukan"})]})]}),e.jsxs("form",{onSubmit:Z,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Maklumat Peribadi"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:["Nama ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsx("input",{type:"text",value:s.nama,onChange:a=>E("nama",a.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-slate-400 focus:border-slate-400 uppercase",required:!0}),n.nama&&e.jsx("p",{className:"text-sm text-rose-600 mt-1",children:n.nama})]}),e.jsxs("div",{ref:N,className:"relative",children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:["No. IC ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsx("input",{type:"text",value:s.no_ic,onChange:J,placeholder:"900101145678",maxLength:"12",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-slate-400 focus:border-slate-400",required:!0}),n.no_ic&&e.jsx("p",{className:"text-sm text-rose-600 mt-1",children:n.no_ic}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Hanya angka sahaja (contoh: 900101145678)"}),G&&K.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-slate-200 rounded-lg shadow-lg max-h-48 overflow-y-auto",children:K.map(a=>e.jsxs("button",{type:"button",onClick:()=>V(a),className:"w-full text-left px-4 py-2.5 hover:bg-slate-50 transition-colors border-b border-slate-100 last:border-0",children:[e.jsx("span",{className:"font-mono text-sm font-medium text-slate-900",children:a.no_ic}),e.jsx("span",{className:"ml-2 text-sm text-slate-500",children:a.nama})]},a.no_ic))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:["Umur ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsx("input",{type:"number",value:s.umur,onChange:a=>r("umur",a.target.value),min:"1",max:"150",readOnly:!0,className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-slate-400 focus:border-slate-400 bg-slate-50",required:!0}),n.umur&&e.jsx("p",{className:"text-sm text-rose-600 mt-1",children:n.umur}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Dikira automatik dari No. IC"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:["No. Telefon ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsx("input",{type:"tel",value:s.no_tel,onChange:Q,placeholder:"0123456789",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-slate-400 focus:border-slate-400",required:!0}),n.no_tel&&e.jsx("p",{className:"text-sm text-rose-600 mt-1",children:n.no_tel}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Hanya angka sahaja"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:["Bangsa ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("select",{value:s.bangsa,onChange:a=>r("bangsa",a.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-slate-400 focus:border-slate-400",required:!0,children:[e.jsx("option",{value:"",children:"Pilih Bangsa"}),q.map(a=>e.jsx("option",{value:a.nama,children:a.nama},a.id))]}),n.bangsa&&e.jsx("p",{className:"text-sm text-rose-600 mt-1",children:n.bangsa})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Maklumat Alamat"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:["Alamat ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsx("textarea",{value:s.alamat,onChange:a=>E("alamat",a.target.value),rows:"3",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-slate-400 focus:border-slate-400 uppercase",required:!0}),n.alamat&&e.jsx("p",{className:"text-sm text-rose-600 mt-1",children:n.alamat})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:["Poskod ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsx("input",{type:"text",value:s.poskod,onChange:X,placeholder:"00000",maxLength:"5",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-slate-400 focus:border-slate-400",required:!0}),n.poskod&&e.jsx("p",{className:"text-sm text-rose-600 mt-1",children:n.poskod})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:["Negeri ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("select",{value:s.negeri,onChange:a=>r("negeri",a.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-slate-400 focus:border-slate-400",required:!0,children:[e.jsx("option",{value:"",children:"Pilih Negeri"}),O.map(a=>e.jsx("option",{value:a.nama,children:a.nama},a.id))]}),n.negeri&&e.jsx("p",{className:"text-sm text-rose-600 mt-1",children:n.negeri})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:["Bandar ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsx("input",{type:"text",value:s.bandar,readOnly:!0,className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-slate-400 focus:border-slate-400 bg-slate-50",placeholder:"Pilih Poskod terlebih dahulu"}),n.bandar&&e.jsx("p",{className:"text-sm text-rose-600 mt-1",children:n.bandar})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:["Parlimen ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("select",{value:s.parlimen,onChange:a=>r("parlimen",a.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-slate-400 focus:border-slate-400",required:!0,children:[e.jsx("option",{value:"",children:Y?"Memuat...":"Pilih Parlimen"}),U.map(a=>e.jsx("option",{value:a.nama,children:a.nama},a.id))]}),n.parlimen&&e.jsx("p",{className:"text-sm text-rose-600 mt-1",children:n.parlimen})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:["KADUN ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("select",{value:s.kadun,onChange:a=>r("kadun",a.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-slate-400 focus:border-slate-400",required:!0,children:[e.jsx("option",{value:"",children:R?"Memuat...":"Pilih KADUN"}),F.map(a=>e.jsx("option",{value:a.nama,children:a.nama},a.id))]}),n.kadun&&e.jsx("p",{className:"text-sm text-rose-600 mt-1",children:n.kadun})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:["MPKK ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("select",{value:s.mpkk,onChange:a=>r("mpkk",a.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-slate-400 focus:border-slate-400",required:!0,children:[e.jsx("option",{value:"",children:W?"Memuat...":"Pilih MPKK"}),z.map(a=>e.jsx("option",{value:a.nama,children:a.nama},a.id))]}),n.mpkk&&e.jsx("p",{className:"text-sm text-rose-600 mt-1",children:n.mpkk})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:["Daerah Mengundi ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("select",{value:s.daerah_mengundi,onChange:a=>r("daerah_mengundi",a.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-slate-400 focus:border-slate-400",required:!0,children:[e.jsx("option",{value:"",children:H?"Memuat...":"Pilih Daerah Mengundi"}),s.daerah_mengundi&&!M.some(a=>a.nama===s.daerah_mengundi)&&e.jsx("option",{value:s.daerah_mengundi,children:s.daerah_mengundi}),M.map(a=>e.jsx("option",{value:a.nama,children:a.nama},a.id))]}),n.daerah_mengundi&&e.jsx("p",{className:"text-sm text-rose-600 mt-1",children:n.daerah_mengundi})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Lokaliti"}),e.jsxs("select",{value:s.lokaliti,onChange:a=>r("lokaliti",a.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-slate-400 focus:border-slate-400",children:[e.jsx("option",{value:"",children:"Pilih Lokaliti"}),s.lokaliti&&!(h||[]).some(a=>a.nama===s.lokaliti)&&e.jsx("option",{value:s.lokaliti,children:s.lokaliti}),h&&h.map(a=>e.jsx("option",{value:a.nama,children:a.nama},a.id))]}),n.lokaliti&&e.jsx("p",{className:"text-sm text-rose-600 mt-1",children:n.lokaliti})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Maklumat Politik"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Keahlian Parti"}),e.jsxs("select",{value:s.keahlian_parti,onChange:a=>r("keahlian_parti",a.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-slate-400 focus:border-slate-400",children:[e.jsx("option",{value:"",children:"Pilih Keahlian Parti"}),A.map(a=>e.jsx("option",{value:a.nama,children:a.nama},a.id))]}),n.keahlian_parti&&e.jsx("p",{className:"text-sm text-rose-600 mt-1",children:n.keahlian_parti})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Kecenderungan Politik"}),e.jsxs("select",{value:s.kecenderungan_politik,onChange:a=>r("kecenderungan_politik",a.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-slate-400 focus:border-slate-400",children:[e.jsx("option",{value:"",children:"Pilih Kecenderungan Politik"}),B.map(a=>e.jsx("option",{value:a.nama,children:a.nama},a.id))]}),n.kecenderungan_politik&&e.jsx("p",{className:"text-sm text-rose-600 mt-1",children:n.kecenderungan_politik})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pb-6",children:[e.jsx("button",{type:"button",onClick:()=>window.history.back(),className:"px-6 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 transition-colors",children:"Batal"}),e.jsx("button",{type:"submit",disabled:_,className:"px-6 py-2 bg-slate-900 text-white rounded-lg hover:bg-slate-800 transition-colors disabled:opacity-50",children:_?"Menyimpan...":"Simpan"})]})]})]})]})}export{ge as default};
