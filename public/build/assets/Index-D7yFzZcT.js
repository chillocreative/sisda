import{r as d,u as C,b as x,j as e,H as S}from"./app-D0qDnIdI.js";import{A as D,i as p,D as M}from"./AuthenticatedLayout-Dv3_JOXg.js";import{C as L}from"./circle-check-big-BeFN-SYD.js";import{C as P}from"./circle-x-DfYAfFIY.js";import{T as F}from"./triangle-alert-2tsxYSai.js";import{L as c}from"./loader-circle-BFjRLQQR.js";import{c as I}from"./createLucideIcon-DSPYBP-L.js";import{T as u}from"./trash-2-oLL1srqK.js";import"./phone-DeDdUclu.js";const T=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],A=I("refresh-cw",T);function Y({batches:t,flash:l}){const[a,r]=d.useState(null),{data:h,setData:f,post:g,processing:o,errors:m,reset:j}=C({fail:null}),i=d.useRef(null),n=t.data.some(s=>s.status==="processing");d.useEffect(()=>{if(!n)return;const s=setInterval(()=>{x.reload({only:["batches"]})},5e3);return()=>clearInterval(s)},[n]);const N=s=>{f("fail",s.target.files[0])},b=s=>{s.preventDefault(),g(route("upload-database.store"),{forceFormData:!0,onSuccess:()=>{j(),i.current&&(i.current.value="")}})},y=s=>{x.post(route("upload-database.restore",s.id))},k=s=>{r(s)},v=()=>{a&&x.delete(route("upload-database.destroy",a.id),{onFinish:()=>r(null)})},w=s=>{switch(s){case"completed":return e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"Selesai"});case"processing":return e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[e.jsx(c,{className:"h-3 w-3 animate-spin"}),"Memproses"]});case"failed":return e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:"Gagal"});default:return null}};return e.jsxs(D,{children:[e.jsx(S,{title:"Upload Database Pengundi"}),e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Upload Database Pengundi"}),e.jsx("p",{className:"text-sm text-slate-600 mt-1",children:"Muat naik fail ZIP yang mengandungi data pengundi (format: DUN › Daerah Mengundi › LOCALITIES › *.xlsx)"})]}),l?.success&&e.jsxs("div",{className:"flex items-center gap-3 bg-green-50 border border-green-200 text-green-800 rounded-lg px-4 py-3",children:[e.jsx(L,{className:"h-5 w-5 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:l.success})]}),l?.error&&e.jsxs("div",{className:"flex items-center gap-3 bg-red-50 border border-red-200 text-red-800 rounded-lg px-4 py-3",children:[e.jsx(P,{className:"h-5 w-5 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:l.error})]}),n&&e.jsxs("div",{className:"flex items-center gap-3 bg-yellow-50 border border-yellow-200 text-yellow-800 rounded-lg px-4 py-3",children:[e.jsx(F,{className:"h-5 w-5 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:"Pemprosesan data sedang berjalan di latar belakang. Halaman ini akan dikemaskini secara automatik setiap 5 saat."}),e.jsx(c,{className:"h-4 w-4 animate-spin flex-shrink-0 ml-auto"})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[e.jsx(p,{className:"h-5 w-5"}),"Muat Naik Fail ZIP"]}),e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:["Fail ZIP ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsx("input",{ref:i,type:"file",accept:".zip",onChange:N,className:"block w-full text-sm text-slate-700 border border-slate-300 rounded-lg cursor-pointer bg-slate-50 focus:outline-none file:mr-4 file:py-2 file:px-4 file:rounded-l-lg file:border-0 file:text-sm file:font-medium file:bg-slate-900 file:text-white hover:file:bg-slate-800",required:!0}),m.fail&&e.jsx("p",{className:"text-sm text-rose-600 mt-1",children:m.fail}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Hanya fail .zip sahaja. Saiz maksimum: 100MB."})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("button",{type:"submit",disabled:o||!h.fail,className:"flex items-center gap-2 px-6 py-2 bg-slate-900 text-white rounded-lg hover:bg-slate-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:o?e.jsxs(e.Fragment,{children:[e.jsx(c,{className:"h-4 w-4 animate-spin"}),"Memuat naik..."]}):e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"h-4 w-4"}),"Muat Naik"]})})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5"}),"Sejarah Muat Naik"]}),t.data.length===0?e.jsx("p",{className:"text-sm text-slate-500 text-center py-8",children:"Tiada rekod muat naik."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-200",children:[e.jsx("th",{className:"text-left py-3 px-3 font-medium text-slate-600",children:"Bil"}),e.jsx("th",{className:"text-left py-3 px-3 font-medium text-slate-600",children:"Nama Fail"}),e.jsx("th",{className:"text-left py-3 px-3 font-medium text-slate-600",children:"Tarikh Upload"}),e.jsx("th",{className:"text-right py-3 px-3 font-medium text-slate-600",children:"Jumlah Rekod"}),e.jsx("th",{className:"text-center py-3 px-3 font-medium text-slate-600",children:"Status"}),e.jsx("th",{className:"text-center py-3 px-3 font-medium text-slate-600",children:"Aktif"}),e.jsx("th",{className:"text-center py-3 px-3 font-medium text-slate-600",children:"Tindakan"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:t.data.map((s,_)=>e.jsxs("tr",{className:"hover:bg-slate-50",children:[e.jsx("td",{className:"py-3 px-3 text-slate-600",children:(t.current_page-1)*t.per_page+_+1}),e.jsx("td",{className:"py-3 px-3 text-slate-900 font-medium max-w-xs truncate",children:s.nama_fail}),e.jsx("td",{className:"py-3 px-3 text-slate-600",children:new Date(s.created_at).toLocaleString("ms-MY",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}),e.jsx("td",{className:"py-3 px-3 text-slate-900 text-right",children:s.jumlah_rekod.toLocaleString()}),e.jsx("td",{className:"py-3 px-3 text-center",children:w(s.status)}),e.jsx("td",{className:"py-3 px-3 text-center",children:s.is_active?e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"Aktif"}):e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-slate-100 text-slate-600",children:"Tidak Aktif"})}),e.jsx("td",{className:"py-3 px-3",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsxs("button",{onClick:()=>y(s),disabled:s.is_active||s.status==="processing",title:"Jadikan aktif",className:"flex items-center gap-1 px-3 py-1.5 text-xs font-medium rounded-lg border border-slate-300 text-slate-700 hover:bg-slate-100 transition-colors disabled:opacity-40 disabled:cursor-not-allowed",children:[e.jsx(A,{className:"h-3 w-3"}),"Restore"]}),e.jsxs("button",{onClick:()=>k(s),disabled:s.status==="processing",title:"Padam",className:"flex items-center gap-1 px-3 py-1.5 text-xs font-medium rounded-lg border border-red-300 text-red-700 hover:bg-red-50 transition-colors disabled:opacity-40 disabled:cursor-not-allowed",children:[e.jsx(u,{className:"h-3 w-3"}),"Padam"]})]})})]},s.id))})]})}),t.last_page>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-slate-200",children:[e.jsxs("p",{className:"text-sm text-slate-600",children:["Halaman ",t.current_page," daripada ",t.last_page]}),e.jsxs("div",{className:"flex gap-2",children:[t.prev_page_url&&e.jsx("a",{href:t.prev_page_url,className:"px-3 py-1.5 text-sm border border-slate-300 rounded-lg hover:bg-slate-100",children:"Sebelum"}),t.next_page_url&&e.jsx("a",{href:t.next_page_url,className:"px-3 py-1.5 text-sm border border-slate-300 rounded-lg hover:bg-slate-100",children:"Seterusnya"})]})]})]})]})]}),a&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-red-100 flex items-center justify-center",children:e.jsx(u,{className:"h-5 w-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-slate-900",children:"Padam Rekod"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Tindakan ini tidak boleh diundur."})]})]}),e.jsxs("p",{className:"text-sm text-slate-700",children:["Adakah anda pasti mahu memadam ",e.jsx("strong",{children:a.nama_fail}),"? Semua ",e.jsx("strong",{children:a.jumlah_rekod.toLocaleString()})," rekod pengundi akan dipadam bersama."]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{onClick:()=>r(null),className:"px-4 py-2 text-sm border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50",children:"Batal"}),e.jsx("button",{onClick:v,className:"px-4 py-2 text-sm bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Ya, Padam"})]})]})})]})}export{Y as default};
